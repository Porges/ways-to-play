span:is( // Italicize all *-Latn languages:
  [lang*="-Latn"],
  // Italicize non-English (but Latin) languages:
  [lang|=ban],
  // Balinese 
  [lang|=bjn],
  /* Banjarese */
  [lang|=ca],
  // Catalan
  [lang|=da],
  /* Danish */
  [lang|=de],
  /* German */
  [lang|=dtp],
  /* Dusun(ic) */
  [lang|=ee],
  /* Ewe */
  [lang|=es],
  /* Spanish */
  [lang|=fil],
  /* Filipino */
  [lang|=fr],
  /* French */
  [lang|=ga],
  /* Gaelic */
  [lang|=gsw],
  /* Swiss German */
  [lang|=haw],
  /* Hawaiian */
  [lang|=hu],
  /* Hungarian */
  [lang|=id],
  /* Indonesian */
  [lang|=is],
  /* Icelandic */
  [lang|=it],
  /* Italian */
  [lang|=kxd],
  /* Brunei Malay */
  [lang|=la],
  /* Latin */
  [lang|=mi],
  /* Māori */
  [lang|=mg],
  /* Malagasy */
  [lang|=min],
  /* Minangkabau */
  [lang|=mnr],
  /* Mono */
  [lang|=ms],
  /* Malay (meta-language) */
  [lang|=nl],
  /* Dutch */
  [lang|=no],
  /* Norwegian */
  [lang|=pt],
  /* Portuguese */
  [lang|=rng],
  /* Ronga */
  [lang|=sn],
  /* Shona */
  [lang|=so],
  /* Somali */
  [lang|=st],
  /* seSotho */
  [lang|=sv],
  /* Swedish */
  [lang|=tn],
  /* Tswana */
  [lang|=tr],
  // Turkish
  [lang|=urh],
  // Urhobo
  [lang|=ve],
  /* Venda */
  [lang|=vi],
  /* Vietnamese */
  [lang|=zu] // isiZulu
):not(h1 span, h2 span, h3 span, h4 span, h5 span, h6 span
  /* except in headings */
):not(.noun
  /* present proper nouns upright as there is no need to distinguish from surrounding text */
) {
  @include italic-font;
}

body {
  // palt: We are going to be embedding Japanese and Chinese in Latin text,
  //       so make them proportional. This has better spacing for kana etc.
  // hkna: Always writing horizontally here, so prefer horizontally-optimized
  //       forms.
  font-feature-settings: "palt", "hkna";
  // required by 'palt' but enable it this way as well
  font-kerning: normal;
}

rt {
  // why is this not on by default!
  font-variant-east-asian: ruby;
}

/* Override fonts for specific languages.
  We cannot simply list these in the font-family list as
  that will forcibly choose the first one that matches. */

:lang(ja):not(:lang(ja-Latn)):not(h1 *, h2 *, h3 *, h4 *, h5 *, h6 *) {
  font-family:
    "Yu Gothic", // Japanese: Windows font, prefer this to Meiryo which is default otherwise
    sans-serif,
    "UniHentaiKana"; // fallback for Hentaigana chars
}

/* Default Thai font on Windows is a bit heavy */
:lang(th):not(:lang(th-Latn)):not(h1 *, h2 *, h3 *, h4 *, h5 *, h6 *) {
  font-family: "Leelawadee UI", sans-serif;
}

// Raise numbers in Cantonese and Teochew pronunciation guides
:lang(yue-Latn), :lang(tws-Latn) {
  font-feature-settings: "sups";
}

/* For Chinese, the Windows defaults are ok:
  zh: YaHei
  zh-Hans: YaHei
  zh-Hant: JhengHei
  nan: JhengHei
  yue: JhengHei
*/

cite {
  @include italic-font;
}

/* Work titles in non-Latin languages should be upright, not italic: */
cite:lang(zh):not(:lang(zh-Latn)) {
  font-style: inherit;

  &::before {
    content: '《';
  }

  &::after {
    content: '》';
  }
}

cite:lang(ja):not(:lang(ja-Latn)) {
  font-style: inherit;

  &::before {
    content: '『'
  }

  &::after {
    content: '』'
  }
}

cite:lang(ar):not(:lang(ar-Latn)),
cite:lang(fa):not(:lang(fa-Latn)) {
  font-style: inherit;

  &::before {
    content: '“'
  }

  &::after {
    content: '”'
  }
}

/* Fingers crossed these are the same across all fonts.
   These are correct on Yu Mincho and Kozuka Mincho, at least.
 */
.circled {
  font-feature-settings: "nalt" 2
}

.squared {
  font-feature-settings: "nalt" 4
}

.playing-cards {
  font-family: "NKD04";

  /* this font looks disproportionate so scale it down */
  font-size: 0.8em;
  vertical-align: middle;
}

figcaption .playing-cards {
  /* fix alignment in captions… */
  vertical-align: text-top;
}

.red {
  color: #CC0000;
}

.blue {
  color: #0000CC;
}
